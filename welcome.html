<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Noctua Forest">
    <meta name="theme-color" content="#4A5450">
    <title>Noctua Forest - Redesigned</title>
    <link rel="stylesheet" href="assets/tailwind.css">
    <link rel="stylesheet" href="assets/base-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Noto+Serif:wght@400;600;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Safari Compatibility Script -->
  <script src="assets/safari-compat.js"></script>
  
  <!-- Google tag (gtag.js) with Consent Management -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZWN1Z3DYQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    // Set default consent mode
    gtag('consent', 'default', {
      'analytics_storage': 'denied'
    });
    
    gtag('config', 'G-0ZWN1Z3DYQ', {
      'anonymize_ip': true
    });
  </script>
  
  <!-- Cookie Consent Management -->
  <script src="assets/cookie-consent.js"></script>
  
  <!-- Organization Schema Markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Noctua Forest",
    "url": "https://noctuaforest.com",
    "logo": "/images/logo.png",
    "description": "A curated book discovery platform connecting thoughtful readers with quality authors across all genres.",
    "foundingDate": "2024",
    "slogan": "For the writers who burn the midnight oil",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-555-NOCTUA",
      "contactType": "customer service",
      "email": "support@noctuaforest.com"
    },
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "US"
    },
    "sameAs": [
      "https://medium.com/@noctuaforest"
    ],
    "offers": {
      "@type": "Offer",
      "name": "Book Submission Review",
      "description": "Professional manuscript review service",
      "price": "14.99",
      "priceCurrency": "USD"
    },
    "audience": {
      "@type": "Audience",
      "audienceType": "Authors and Readers",
      "name": "Writers and Book Enthusiasts"
    },
    "knowsAbout": [
      "Book Publishing",
      "Literature Discovery", 
      "Author Promotion",
      "Book Reviews",
      "Independent Publishing"
    ]
  }
  </script>
  
  <style>
        body {
            /* Switched to Noto Sans for body text */
            font-family: 'Noto Sans', sans-serif;
            background-color: #fbebcc;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex: 1;
        }
        .font-heading {
            /* Switched to Noto Serif for headings - force override */
            font-family: 'Noto Serif', serif !important;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1448375240586-882707db888b?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        /* Reviews carousel */
        .nf-carousel-mask { 
            -webkit-mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
            mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
        }
        .nf-carousel-track {
            display: flex; gap: 1.5rem; align-items: center; will-change: transform;
            animation: nf-scroll 36s linear infinite;
        }
        @keyframes nf-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        .nf-carousel-item { flex: 0 0 auto; width: 160px; }
        @media (min-width: 768px){ .nf-carousel-item { width: 200px; } }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="flex justify-between items-center">
            <a href="welcome.html" class="flex items-center space-x-3">
                <!-- Noctua Forest Logo -->
                <img src="images/logo.png" alt="Noctua Forest Logo" width="40" height="40" decoding="async" class="w-10 h-10">
                <span class="text-2xl font-bold" style="font-family: 'Poppins', sans-serif; color: #4A5450;">Noctua Forest</span>
            </a>
            <nav id="nav" class="hidden md:flex items-center space-x-8 text-lg ml-auto" style="font-family: 'Noto Sans', sans-serif;">
                <a href="forest.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">The Forest</a>
                <a href="submit.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">Submit Book</a>
                <!-- Contribute link moved into Creator Resources in dashboard for creators -->
                <a href="about.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">About</a>
            </nav>
            <div class="flex items-center gap-2">
                <button class="md:hidden" onclick="toggleMobileMenu()" aria-label="Toggle menu">
                     <svg class="w-6 h-6" fill="none" stroke="#4A5450" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
                <a href="account.html" class="hover:text-forest-accent transition-colors duration-300" aria-label="Account">
                    <svg class="w-6 h-6" fill="none" stroke="#4A5450" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                </a>
            </div>
        </header>
    </div>

    <!-- Hero Section -->
    <main>
        <section class="hero-bg w-full">
            <div class="bg-black/60 text-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-32 text-center">
                    <h1 class="text-4xl md:text-6xl font-bold font-display mb-4">Welcome to <span class="text-[#F9A825]">Noctua Forest</span></h1>
                    <p class="text-lg md:text-xl max-w-3xl mx-auto mb-8">For the writers who burn the midnight oil. Share your manuscript or discover your next great read.</p>
                    <div class="flex justify-center gap-3">
                        <a href="forest.html" class="bg-[#F58220] hover:bg-[#E0751C] text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-lg">Explore</a>
                        <a href="submit.html" class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white font-bold py-3 px-6 md:px-8 rounded-full transition duration-300 border border-white/50">Submit Your Book</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Value Proposition: For Readers / For Writers -->
        <section class="py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-forest-card text-white rounded-2xl shadow-sm p-8 md:p-14">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold leading-tight" style="font-family: 'Poppins', sans-serif;">Find your place in the Forest</h2>
                        <div class="flex items-center gap-4 text-sm md:text-base text-gray-200">
                            <span>Join <strong>50+ Featured Authors</strong></span>
                            <span class="hidden md:inline text-gray-400">|</span>
                            <span><strong>10,000+ Engaged Readers</strong></span>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="flex gap-3 mb-8">
                        <button id="tab-readers" aria-selected="true" class="px-5 py-2.5 rounded-full bg-[#F58220] text-white shadow">Readers</button>
                        <button id="tab-writers" aria-selected="false" class="px-5 py-2.5 rounded-full bg-white/10 text-white/90 hover:bg-white/20 border border-white/20">Writers</button>
                        <button id="tab-creators" aria-selected="false" class="px-5 py-2.5 rounded-full bg-white/10 text-white/90 hover:bg-white/20 border border-white/20">Creators</button>
                    </div>

                    <!-- Panels -->
                    <div id="panel-readers" class="grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Why readers love Noctua</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Discover handâ€‘picked gems across unique genres</li>
                                <li>Follow emerging voices and indie favorites</li>
                                <li>Filter by language, region, and cultural themes</li>
                            </ul>
                            <a href="forest.html" class="inline-block mt-6 px-8 py-3 md:px-9 md:py-3.5 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Explore the Forest</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Curated for quality</h3>
                            <p class="text-white/90 leading-relaxed">Our boutique approach emphasizes thoughtful discovery over volume. Every book earns its place among the trees.</p>
                        </div>
                    </div>

                    <div id="panel-writers" class="hidden grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Why writers choose Noctua</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Submit your manuscript and reach engaged readers</li>
                                <li>Gain visibility in a curated discovery feed</li>
                                <li>Opt for Premium Review for detailed, timely feedback</li>
                            </ul>
                            <a href="submit.html" class="inline-block mt-6 px-7 py-3 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Submit Your Blurb</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Support that scales</h3>
                            <p class="text-white/90 leading-relaxed">From first submission to featured spotlights, we help your work meet the right readersâ€”without the noise.</p>
                        </div>
                    </div>

                    <div id="panel-creators" class="hidden grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Earn by sharing books you love</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Authenticity first: recommend what you genuinely enjoy</li>
                                <li>Earn commissions on referred purchases (Amazon & Bookshop)</li>
                                <li>Optional Premium Review referrals available</li>
                            </ul>
                            <a href="creator-onboarding.html" class="inline-block mt-6 px-7 py-3 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Join the Creator Program</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Simple, transparent, fair</h3>
                            <p class="text-white/90 leading-relaxed">Monetize your book recommendations with clear, platformâ€‘agnostic commissions and weekly payouts. Your audience trusts youâ€”so do we.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Curated Reviews Carousel -->
        <section class="py-14">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-6" style="font-family: 'Poppins', sans-serif; color:#4A5450;">Read our curated reviews</h2>
                <div class="relative overflow-hidden nf-carousel-mask rounded-xl bg-[#4A5450]/5 py-6">
                    <div id="reviewsCarousel" class="nf-carousel-track"></div>
                </div>
            </div>
        </section>

        <!-- Nightly Wisdom Newsletter (relocated) -->
        <section class="py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="bg-forest-card rounded-xl p-8 text-white max-w-2xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Nightly Wisdom</h2>
                    <p class="text-lg mb-8 text-white/90">Subscribe for publishing insights, author spotlights, and creative inspiration delivered to your inbox.</p>
                    <form action="newsletter.html" method="get" class="flex flex-col sm:flex-row justify-center items-center gap-4 max-w-md mx-auto">
                        <input type="email" placeholder="Enter your email" 
                            class="w-full px-4 py-3 rounded-lg bg-forest-secondary/30 border border-transparent text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/20 focus:border-transparent">
                        <button type="submit" 
                            class="w-full sm:w-auto bg-forest-accent hover:bg-[#E67615] text-white font-bold py-3 px-8 rounded-full transition duration-300">
                            Subscribe
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="w-full text-white py-12" style="background-color: #4A5450;">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center items-center space-x-4 mb-4">
                <a href="privacy.html" class="text-gray-300 hover:text-white transition duration-300">Privacy Policy</a>
                <span class="text-gray-500">|</span>
                <a href="terms.html" class="text-gray-300 hover:text-white transition duration-300">Terms of Service</a>
            </div>
            <p>&copy; 2025 Noctua Forest. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js" type="module"></script>
    <script src="firebase-config.js"></script>
    <script type="module">
      import { getFirestore, collection, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';
      import showAlphaPopup from './components/AlphaPopup.js';

      // Show alpha popup
      showAlphaPopup();

      // Tabs logic (Readers / Writers / Creators)
      const tabReaders = document.getElementById('tab-readers');
      const tabWriters = document.getElementById('tab-writers');
      const tabCreators = document.getElementById('tab-creators');
      const panelReaders = document.getElementById('panel-readers');
      const panelWriters = document.getElementById('panel-writers');
      const panelCreators = document.getElementById('panel-creators');

      function selectTab(which){
        const tabs = {
          readers: { tab: tabReaders, panel: panelReaders },
          writers: { tab: tabWriters, panel: panelWriters },
          creators: { tab: tabCreators, panel: panelCreators },
        };
        Object.entries(tabs).forEach(([key, nodes]) => {
          const { tab, panel } = nodes;
          if (!tab || !panel) return;
          const active = key === which;
          panel.classList.toggle('hidden', !active);
          panel.classList.toggle('grid', active);
          tab.setAttribute('aria-selected', active ? 'true' : 'false');
          if (active){
            tab.classList.remove('bg-white/10','text-white/90','border','border-white/20');
            tab.classList.add('bg-[#F58220]','text-white','shadow');
        } else {
            tab.classList.remove('bg-[#F58220]','text-white','shadow');
            tab.classList.add('bg-white/10','text-white/90','border','border-white/20');
          }
        });
      }

      tabReaders?.addEventListener('click', () => selectTab('readers'));
      tabWriters?.addEventListener('click', () => selectTab('writers'));
      tabCreators?.addEventListener('click', () => selectTab('creators'));

      // Try to load curated books from Firestore for the carousel
      (async function loadCuratedReviews(){
        try{
          const db = getFirestore(app);
          const q = query(collection(db, 'books'), orderBy('publishedAt','desc'), limit(12));
          const snap = await getDocs(q);
          const track = document.getElementById('reviewsCarousel');
          if (!track) return;
          if (!snap.empty){
            track.innerHTML = '';
            const items = [];
            snap.forEach(docSnap => {
              const d = docSnap.data();
              const a = document.createElement('a');
              a.href = `book.html?id=${docSnap.id}`;
              a.className = 'nf-carousel-item text-center';
              a.setAttribute('aria-label', `Read our review: ${d.title || 'Untitled'} by ${d.author || ''}`);
              const img = document.createElement('img');
              const cover = d.coverUrl || '';
              img.src = cover; img.alt = `${d.title || 'Untitled'} cover`; img.loading = 'lazy';
              img.className = 'w-full h-auto rounded-lg shadow-md mb-2 object-contain';
              img.width = 200; img.height = 300;
              const cap = document.createElement('div');
              cap.className = 'text-sm text-[#4A5450]';
              cap.textContent = d.title || 'Untitled';
              a.appendChild(img); a.appendChild(cap);
              items.push(a);
            });
            const duo = items.concat(items.map(n=>n.cloneNode(true)));
            duo.forEach(n => track.appendChild(n));
          }
        }catch(e){ /* fallback handled by non-module script */ }
      })();
    </script>
    <script src="sample-books.js"></script>
    <script>
        // Mobile menu toggle with contrast-friendly styles
        function toggleMobileMenu() {
            const nav = document.getElementById('nav');
            if (!nav) return;
            const isHidden = nav.classList.contains('hidden');
            // Toggle visibility & layout
            nav.classList.toggle('hidden');
            nav.classList.toggle('flex');
            nav.classList.toggle('flex-col');
            // Unified mobile nav look
            nav.classList.toggle('nf-mobile-nav');
            // High-contrast text/background when opened
            if (isHidden) {
                nav.style.backgroundColor = '#3A4440'; // dark
                nav.style.color = '#E0E2DB'; // light text
                // Ensure links inherit contrast color on mobile
                nav.querySelectorAll('a').forEach(function(a){ a.style.color = '#E0E2DB'; a.classList.add('block'); a.classList.add('py-3'); a.classList.add('px-4'); a.classList.remove('md:py-0'); a.classList.remove('md:px-0'); });
            } else {
                nav.style.backgroundColor = '';
                nav.style.color = '';
                nav.querySelectorAll('a').forEach(function(a){ a.style.color = ''; });
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.querySelector('button[onclick="toggleMobileMenu()"]');
            if (menuButton) {
                menuButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    toggleMobileMenu();
                }, { passive: false });
            }
        });
      // Build moving carousel from sample books
      (function(){
        try{
          const track = document.getElementById('reviewsCarousel');
          if(!track || track.children.length) return;
          const books = (window.SAMPLE_BOOKS || []).slice(0, 8);
          const duo = books.concat(books); // duplicate for seamless scroll
          const makeItem = (b) => {
            const a = document.createElement('a');
            a.href = `book.html?id=${b.id}`;
            a.className = 'nf-carousel-item text-center';
            a.setAttribute('aria-label', `Read our review: ${b.title} by ${b.author}`);
            const img = document.createElement('img');
            const cover = (window.coverFor ? window.coverFor(b) : (b.coverUrl || ''));
            img.src = cover; img.alt = `${b.title} cover`; img.loading = 'lazy';
            img.className = 'w-full h-auto rounded-lg shadow-md mb-2 object-contain';
            img.width = 200; img.height = 300;
            const cap = document.createElement('div');
            cap.className = 'text-sm text-[#4A5450]';
            cap.textContent = b.title;
            a.appendChild(img); a.appendChild(cap);
            return a;
          };
          duo.forEach(b => track.appendChild(makeItem(b)));
        }catch(e){ console.warn('carousel init failed', e); }
      })();
    </script>
</body>
</html>