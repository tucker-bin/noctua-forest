<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Noctua Forest">
    <meta name="theme-color" content="#4A5450">
    <title>Noctua Forest - Redesigned</title>
    <link rel="stylesheet" href="assets/tailwind.css">
    <link rel="stylesheet" href="assets/base-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Noto+Serif:wght@400;600;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Safari Compatibility Script -->
  <script src="assets/safari-compat.js"></script>
  
  <!-- Google tag (gtag.js) with Consent Management -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZWN1Z3DYQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    // Set default consent mode
    gtag('consent', 'default', {
      'analytics_storage': 'denied'
    });
    
    gtag('config', 'G-0ZWN1Z3DYQ', {
      'anonymize_ip': true
    });
  </script>
  
  <!-- Cookie Consent Management -->
  <script src="assets/cookie-consent.js"></script>
  
  <!-- Organization Schema Markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Noctua Forest",
    "url": "https://noctuaforest.com",
    "logo": "/images/logo.png",
    "description": "A curated book discovery platform connecting thoughtful readers with quality authors across all genres.",
    "foundingDate": "2024",
    "slogan": "For the writers who burn the midnight oil",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+1-555-NOCTUA",
      "contactType": "customer service",
      "email": "support@noctuaforest.com"
    },
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "US"
    },
    "sameAs": [
      "https://medium.com/@noctuaforest"
    ],
    "offers": {
      "@type": "Offer",
      "name": "Book Submission Review",
      "description": "Professional manuscript review service",
      "price": "14.99",
      "priceCurrency": "USD"
    },
    "audience": {
      "@type": "Audience",
      "audienceType": "Authors and Readers",
      "name": "Writers and Book Enthusiasts"
    },
    "knowsAbout": [
      "Book Publishing",
      "Literature Discovery", 
      "Author Promotion",
      "Book Reviews",
      "Independent Publishing"
    ]
  }
  </script>
  
  <!-- Service + FAQ Schema Markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": "Noctua Forest + Staff Book Review",
    "provider": {
      "@type": "Organization",
      "name": "Noctua Forest",
      "url": "https://noctuaforest.com"
    },
    "areaServed": "Worldwide",
    "serviceType": "Editorial book review for authors",
    "description": "Approximately 500-word editorial staff review pinned on your book page, with optional discretionary feature mentions on landing page, newsletters, or social media.",
    "termsOfService": "https://noctuaforest.com/terms.html"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is included in a staff review?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Approximately 500 words from our staff plus 1–2 pull quotes, pinned on your deep book page for readers."
        }
      },
      {
        "@type": "Question",
        "name": "How long does it take?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Typical turnaround is 1–2 weeks depending on the queue. Timing is shown at checkout."
        }
      },
      {
        "@type": "Question",
        "name": "Can I share the review elsewhere?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. You may share it on your website, social channels, and marketing materials with attribution to Noctua Forest."
        }
      },
      {
        "@type": "Question",
        "name": "Is this a retailer review?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No. We do not sell retailer reviews. This is an editorial review for your readers and website."
        }
      },
      {
        "@type": "Question",
        "name": "What if you decline or miss the window?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "If we decline your book or cannot fulfill within the stated timeframe, you may request a refund."
        }
      }
    ]
  }
  </script>
  
  <style>
        body {
            /* Switched to Noto Sans for body text */
            font-family: 'Noto Sans', sans-serif;
            background-color: #fbebcc;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex: 1;
        }
        .font-heading {
            /* Switched to Noto Serif for headings - force override */
            font-family: 'Noto Serif', serif !important;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1448375240586-882707db888b?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        /* Reviews carousel */
        .nf-carousel-mask { 
            -webkit-mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
            mask-image: linear-gradient(to right, transparent, black 8%, black 92%, transparent);
        }
        .nf-carousel-track {
            display: flex; gap: 1.5rem; align-items: center; will-change: transform;
            animation: nf-scroll 36s linear infinite;
        }
        @keyframes nf-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        .nf-carousel-item { flex: 0 0 auto; width: 160px; }
        @media (min-width: 768px){ .nf-carousel-item { width: 200px; } }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="flex justify-between items-center">
            <a href="welcome.html" class="flex items-center space-x-3">
                <!-- Noctua Forest Logo -->
                <img src="images/logo.png" alt="Noctua Forest Logo" width="40" height="40" decoding="async" class="w-10 h-10">
                <span class="text-2xl font-bold" style="font-family: 'Poppins', sans-serif; color: #4A5450;">Noctua Forest</span>
            </a>
            <nav id="nav" class="hidden md:flex items-center space-x-8 text-lg ml-auto" style="font-family: 'Noto Sans', sans-serif;">
                <a href="forest.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">The Forest</a>
                <a href="submit.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">Submit Book</a>
                <!-- Contribute link moved into Creator Resources in dashboard for creators -->
                <a href="about.html" class="hover:text-forest-accent transition-colors duration-300 font-medium block md:inline-block py-3 md:py-0 px-4 md:px-0 text-left md:text-center">About</a>
            </nav>
            <div class="flex items-center space-x-8">
                <button id="mobileMenuBtn" class="md:hidden" aria-label="Toggle menu">
                     <svg class="w-6 h-6" fill="none" stroke="#4A5450" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
                <a href="account.html" class="hover:text-forest-accent transition-colors duration-300" aria-label="Account">
                    <svg class="w-6 h-6" fill="none" stroke="#4A5450" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                </a>
            </div>
        </header>
    </div>

    <!-- Hero Section -->
    <main>
        <section class="hero-bg w-full">
            <div class="bg-black/60 text-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-32 text-center">
                    <h1 class="text-4xl md:text-6xl font-bold font-display mb-4">Welcome to <span class="text-[#F9A825]">Noctua Forest</span></h1>
                    <p class="text-lg md:text-xl max-w-3xl mx-auto mb-8">Create trackable reading lists, share books you love, and earn commissions on qualifying purchases.</p>
                    <div class="flex justify-center gap-3">
                        <a href="forest.html" class="bg-[#F58220] hover:bg-[#E0751C] text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-lg">Explore</a>
                        <a href="submit.html" class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white font-bold py-3 px-6 md:px-8 rounded-full transition duration-300 border border-white/50">Submit Your Book</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Curated Reviews Carousel -->
        <section class="py-14">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-6" style="font-family: 'Poppins', sans-serif; color:#4A5450;">Read our curated reviews</h2>
                <div class="relative overflow-hidden nf-carousel-mask rounded-xl bg-[#4A5450]/5 py-6">
                    <div id="reviewsCarousel" class="nf-carousel-track"></div>
                </div>
            </div>
        </section>

        <!-- Value Proposition: For Readers / For Writers -->
        <section class="py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-forest-card text-white rounded-2xl shadow-sm p-8 md:p-14">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold leading-tight" style="font-family: 'Poppins', sans-serif;">Find your place in the Forest</h2>
                        <div class="flex items-center gap-4 text-sm md:text-base text-gray-200">
                        <span>Join <strong>50+ Featured Books</strong></span>
                            <span class="hidden md:inline text-gray-400">|</span>
                            <span><strong>10,000+ Engaged Readers</strong></span>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="flex gap-3 mb-8">
                        <button id="tab-readers" aria-selected="true" class="px-5 py-2.5 rounded-full bg-[#F58220] text-white shadow">Readers</button>
                        <button id="tab-writers" aria-selected="false" class="px-5 py-2.5 rounded-full bg-white/10 text-white/90 hover:bg-white/20 border border-white/20">Writers</button>
                        <button id="tab-creators" aria-selected="false" class="px-5 py-2.5 rounded-full bg-white/10 text-white/90 hover:bg-white/20 border border-white/20">Creators</button>
                    </div>

                    <!-- Panels -->
                    <div id="panel-readers" class="grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Why readers love Noctua</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Discover hand‑picked gems across unique genres</li>
                                <li>Follow emerging voices and indie favorites</li>
                                <li>Filter by language, region, and cultural themes</li>
                            </ul>
                            <a href="forest.html" class="inline-block mt-6 px-8 py-3 md:px-9 md:py-3.5 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Explore the Forest</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Curated for quality</h3>
                            <p class="text-white/90 leading-relaxed">Our boutique approach emphasizes thoughtful discovery over volume. Every book earns its place among the trees.</p>
                        </div>
                    </div>

                    <div id="panel-writers" class="hidden grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Why writers choose Noctua</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Submit your manuscript and reach engaged readers</li>
                                <li>Gain visibility in a curated discovery feed</li>
                                <li>Optional staff review for detailed feedback</li>
                            </ul>
                            <a href="submit.html" class="inline-block mt-6 px-7 py-3 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Submit Your Blurb</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Support that scales</h3>
                            <p class="text-white/90 leading-relaxed">From first submission to featured spotlights, we help your work meet the right readers—without the noise.</p>
                        </div>
                    </div>

                    <div id="panel-creators" class="hidden grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-forest-card text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Earn by sharing books you love</h3>
                            <ul class="list-disc pl-5 space-y-3 text-white/90 leading-relaxed">
                                <li>Curate and share trackable reading lists</li>
                                <li>Earn commissions on qualifying purchases (Bookshop.org & Amazon)</li>
                                <li>Simple attribution from your list links</li>
                            </ul>
                            <a href="creator-onboarding.html" class="inline-block mt-6 px-7 py-3 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Apply as an Author-Creator</a>
                        </div>
                        <div class="bg-forest-secondary text-white rounded-xl px-6 py-10 md:px-8 min-h-[260px]">
                            <h3 class="text-2xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Simple, transparent, fair</h3>
                            <p class="text-white/90 leading-relaxed">Creators earn commissions on purchases driven by their lists. Clear tracking, creator-first payouts.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- New Author Promo (toggleable) -->
        <section id="newAuthorPromo" class="py-10 hidden">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-forest-card text-white rounded-2xl p-6 md:p-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h3 class="text-2xl font-bold mb-1" style="font-family: 'Poppins', sans-serif;">New author? Get discovered</h3>
                        <p class="text-white/90">We occasionally feature debut and indie titles submitted to The Forest. Opt‑in when you submit; mentions are editorial and not guaranteed.</p>
                    </div>
                    <div class="flex-shrink-0">
                        <a href="submit.html" class="inline-block px-6 py-3 bg-forest-accent hover:bg-[#E0751C] text-white rounded-full">Submit Your Book</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Why Us -->
        <section class="py-14">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-4" style="font-family: 'Poppins', sans-serif; color:#4A5450;">Why authors choose Noctua Forest</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-forest-card text-white rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-2">Honest editorial reviews</h3>
                        <p class="text-white/90">A professional staff review you can share with readers and on your site. We do not sell retailer reviews.</p>
                    </div>
                    <div class="bg-forest-card text-white rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-2">Pinned on your book page</h3>
                        <p class="text-white/90">Approximately 500 words plus pull quotes, pinned on your deep book page for lasting context.</p>
                    </div>
                    <div class="bg-forest-card text-white rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-2">Clear steps and timelines</h3>
                        <p class="text-white/90">Simple submission, clear turnaround, and discretionary feature mentions when a fit. <a class="underline" href="submit.html">Learn how we work</a>.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ with dropdowns -->
        <section class="py-14 bg-forest-card">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-8 text-white" style="font-family: 'Poppins', sans-serif;">Frequently asked questions</h2>
                <div class="max-w-3xl mx-auto space-y-4">
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">What is included in a staff review?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            Approximately 500 words from our staff plus 1–2 pull quotes, pinned on your book page for readers.
                        </div>
                    </div>
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">How long does it take?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            Typical turnaround is 1–2 weeks depending on the queue. You will see timing at checkout.
                        </div>
                    </div>
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">Can I share the review elsewhere?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            Yes. You can share it on your site, socials, and marketing materials with attribution to Noctua Forest.
                        </div>
                    </div>
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">Is this a retailer review?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            No. We do not sell retailer reviews. This is an editorial review for your readers and website.
                        </div>
                    </div>
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">What does membership include?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            Access to our creator network, reading lists, community reviews, and monthly author Q&As. <a href="membership.html" class="underline">Join membership</a>. The staff review is a <a href="submit.html" class="underline">one-time service</a>.
                        </div>
                    </div>
                    <div class="bg-[#3A4440] rounded-xl overflow-hidden">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center text-white">
                            <span class="font-semibold">What if you decline or miss the window?</span>
                            <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div class="faq-content hidden px-6 pb-4 text-white/80">
                            If we decline your book or cannot fulfill within the stated timeframe, you may request a refund.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nightly Wisdom Newsletter (relocated) -->
        <section class="py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="bg-forest-card rounded-xl p-8 text-white max-w-2xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4 text-white" style="font-family: 'Poppins', sans-serif;">Nightly Wisdom</h2>
                    <p class="text-lg mb-8 text-white/90">Subscribe for publishing insights, author spotlights, and creative inspiration delivered to your inbox.</p>
                    <form id="newsletterForm" class="flex flex-col sm:flex-row justify-center items-center gap-4 max-w-md mx-auto">
                        <input type="email" id="newsletterEmail" placeholder="Enter your email" required
                            class="w-full px-4 py-3 rounded-lg bg-forest-secondary/30 border border-transparent text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/20 focus:border-transparent">
                        <button type="submit" 
                            class="w-full sm:w-auto bg-forest-accent hover:bg-[#E67615] text-white font-bold py-3 px-8 rounded-full transition duration-300">
                            Join the forest
                        </button>
                    </form>
                    <p id="newsletterStatus" class="mt-4 text-white/90 hidden"></p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="w-full text-white py-12" style="background-color: #4A5450;">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center items-center space-x-4 mb-4">
                <a href="privacy.html" class="text-gray-300 hover:text-white transition duration-300">Privacy Policy</a>
                <span class="text-gray-500">|</span>
                <a href="terms.html" class="text-gray-300 hover:text-white transition duration-300">Terms of Service</a>
            </div>
            <p>&copy; 2025 Noctua Forest. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase -->
    <script type="module">
      import { app, db } from './firebase-config.js';
      import { collection, addDoc, serverTimestamp, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';
      import showAlphaPopup from './components/AlphaPopup.js';

      // Show alpha popup
      showAlphaPopup();

      // Tabs logic (Readers / Writers / Creators)
      const tabReaders = document.getElementById('tab-readers');
      const tabWriters = document.getElementById('tab-writers');
      const tabCreators = document.getElementById('tab-creators');
      const panelReaders = document.getElementById('panel-readers');
      const panelWriters = document.getElementById('panel-writers');
      const panelCreators = document.getElementById('panel-creators');

      function selectTab(which){
        const tabs = {
          readers: { tab: tabReaders, panel: panelReaders },
          writers: { tab: tabWriters, panel: panelWriters },
          creators: { tab: tabCreators, panel: panelCreators },
        };
        Object.entries(tabs).forEach(([key, nodes]) => {
          const { tab, panel } = nodes;
          if (!tab || !panel) return;
          const active = key === which;
          panel.classList.toggle('hidden', !active);
          panel.classList.toggle('grid', active);
          tab.setAttribute('aria-selected', active ? 'true' : 'false');
          if (active){
            tab.classList.remove('bg-white/10','text-white/90','border','border-white/20');
            tab.classList.add('bg-[#F58220]','text-white','shadow');
        } else {
            tab.classList.remove('bg-[#F58220]','text-white','shadow');
            tab.classList.add('bg-white/10','text-white/90','border','border-white/20');
          }
        });
      }

      tabReaders?.addEventListener('click', () => selectTab('readers'));
      tabWriters?.addEventListener('click', () => selectTab('writers'));
      tabCreators?.addEventListener('click', () => selectTab('creators'));

      // Try to load curated books from Firestore for the carousel
      (async function loadCuratedReviews(){
        try{
          const db = getFirestore(app);
          const q = query(collection(db, 'books'), orderBy('publishedAt','desc'), limit(12));
          const snap = await getDocs(q);
          const track = document.getElementById('reviewsCarousel');
          if (!track) return;
          if (!snap.empty){
            track.innerHTML = '';
            const items = [];
            snap.forEach(docSnap => {
              const d = docSnap.data();
              const a = document.createElement('a');
              a.href = `book.html?id=${docSnap.id}`;
              a.className = 'nf-carousel-item text-center';
              a.setAttribute('aria-label', `Read our review: ${d.title || 'Untitled'} by ${d.author || ''}`);
              const img = document.createElement('img');
              const cover = d.coverUrl || '';
              img.src = cover; img.alt = `${d.title || 'Untitled'} cover`; img.loading = 'lazy';
              img.className = 'w-full h-auto rounded-lg shadow-md mb-2 object-contain';
              img.width = 200; img.height = 300;
              const cap = document.createElement('div');
              cap.className = 'text-sm text-[#4A5450]';
              cap.textContent = d.title || 'Untitled';
              a.appendChild(img); a.appendChild(cap);
              items.push(a);
            });
            const duo = items.concat(items.map(n=>n.cloneNode(true)));
            duo.forEach(n => track.appendChild(n));
          }
        }catch(e){ /* fallback handled by non-module script */ }
      })();
    </script>
    <script src="sample-books.js"></script>
    <script>
        // Mobile menu toggle with contrast-friendly styles
        function toggleMobileMenu() {
            // Only run on mobile - prevent desktop interference
            if (window.innerWidth >= 768) return;
            
            const nav = document.getElementById('nav');
            if (!nav) return;
            
            const isHidden = nav.classList.contains('hidden');
            
            if (isHidden) {
                // Show mobile menu
                nav.classList.remove('hidden');
                nav.classList.add('mobile-nav-open');
            } else {
                // Hide mobile menu
                nav.classList.add('hidden');
                nav.classList.remove('mobile-nav-open');
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('mobileMenuBtn');
            if (menuButton) {
                menuButton.addEventListener('click', () => toggleMobileMenu());
                menuButton.addEventListener('touchend', (e) => { e.preventDefault(); toggleMobileMenu(); }, { passive: false });
            }
        });
      // Handle newsletter subscription
      const newsletterForm = document.getElementById('newsletterForm');
      const newsletterStatus = document.getElementById('newsletterStatus');
      
      if (newsletterForm) {
        newsletterForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('newsletterEmail')?.value?.trim();
          if (!email) return;

          newsletterStatus.textContent = 'Subscribing...';
          newsletterStatus.classList.remove('hidden', 'text-red-400');

          try {
            await addDoc(collection(db, 'newsletter_subscribers'), {
              email,
              subscribedAt: serverTimestamp(),
              source: 'welcome_page'
            });

            newsletterStatus.textContent = 'Welcome to the forest! Check your inbox soon.';
            newsletterForm.reset();
          } catch (error) {
            console.error('Newsletter subscription failed:', error);
            newsletterStatus.textContent = 'Subscription failed. Please try again.';
            newsletterStatus.classList.add('text-red-400');
          }
        });
      }

      // Build moving carousel from sample books
      (function(){
        try{
          const track = document.getElementById('reviewsCarousel');
          if(!track || track.children.length) return;
          const books = (window.SAMPLE_BOOKS || []).slice(0, 8);
          const duo = books.concat(books); // duplicate for seamless scroll
          const makeItem = (b) => {
            const a = document.createElement('a');
            a.href = `book.html?id=${b.id}`;
            a.className = 'nf-carousel-item text-center';
            a.setAttribute('aria-label', `Read our review: ${b.title} by ${b.author}`);
            const img = document.createElement('img');
            const cover = (window.coverFor ? window.coverFor(b) : (b.coverUrl || ''));
            img.src = cover; img.alt = `${b.title} cover`; img.loading = 'lazy';
            img.className = 'w-full h-auto rounded-lg shadow-md mb-2 object-contain';
            img.width = 200; img.height = 300;
            const cap = document.createElement('div');
            cap.className = 'text-sm text-[#4A5450]';
            cap.textContent = b.title;
            a.appendChild(img); a.appendChild(cap);
            return a;
          };
          duo.forEach(b => track.appendChild(makeItem(b)));
        }catch(e){ console.warn('carousel init failed', e); }
      })();

      // FAQ dropdowns
      document.querySelectorAll('.faq-toggle').forEach(button => {
        button.addEventListener('click', () => {
          const content = button.nextElementSibling;
          const arrow = button.querySelector('svg');
          const isOpen = !content.classList.contains('hidden');
          
          // Close all other FAQs
          document.querySelectorAll('.faq-content').forEach(c => {
            if (c !== content) {
              c.classList.add('hidden');
              c.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
            }
          });
          
          // Toggle this FAQ
          content.classList.toggle('hidden');
          arrow.classList.toggle('rotate-180');
        });
      });

      // Toggle new author promo via global flag (can be set server-side)
      try {
        const showPromo = window.__SHOW_NEW_AUTHOR_PROMO__ === true;
        const promo = document.getElementById('newAuthorPromo');
        if (promo) promo.classList.toggle('hidden', !showPromo);
      } catch (_) {}
    </script>
</body>
</html>