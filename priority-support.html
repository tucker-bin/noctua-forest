<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priority Support — Noctua Forest</title>
    <meta name="description" content="Get priority support with Curator Plus">
    <link rel="stylesheet" href="assets/tailwind.css">
    <link rel="stylesheet" href="assets/base-styles.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Noto+Serif:wght@400;600;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-[#fbebcc]">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="flex justify-between items-center mb-8">
            <a href="dashboard.html" class="flex items-center space-x-3">
                <svg class="w-6 h-6 text-forest-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
                </svg>
                <span class="text-lg font-medium text-forest-accent">Back to Dashboard</span>
            </a>
            <div class="flex items-center space-x-3">
                <img src="images/logo.png" alt="Noctua Forest Logo" width="32" height="32" decoding="async" class="w-8 h-8">
                <span class="text-xl font-bold" style="font-family: 'Poppins', sans-serif; color: #4A5450;">Noctua Forest</span>
            </div>
        </header>

        <main class="max-w-2xl mx-auto">
            <!-- Header -->
            <div class="bg-forest-card rounded-xl p-8 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-2" style="font-family: 'Poppins', sans-serif;">Priority Support</h1>
                        <p class="text-white/80">Get faster response times with Curator Plus</p>
                    </div>
                    <div class="bg-forest-accent px-4 py-2 rounded-full text-sm font-medium">
                        Curator Plus
                    </div>
                </div>
                
                <div class="bg-white/10 rounded-lg p-4">
                    <div class="flex items-center mb-2">
                        <svg class="w-5 h-5 mr-2 text-forest-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <h3 class="font-semibold text-white">Priority Response</h3>
                    </div>
                    <p class="text-white/80 text-sm">Curator Plus members get priority support with faster response times (typically within 24 hours).</p>
                </div>
            </div>

            <!-- Support Form -->
            <div class="bg-white rounded-xl p-8">
                <h2 class="text-xl font-semibold mb-6 text-[#4A5450]">Contact Support</h2>
                
                <form id="supportForm" class="space-y-6">
                    <div>
                        <label for="subject" class="block text-sm font-medium text-[#4A5450] mb-2">Subject</label>
                        <input type="text" id="subject" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-forest-accent">
                    </div>
                    
                    <div>
                        <label for="category" class="block text-sm font-medium text-[#4A5450] mb-2">Category</label>
                        <select id="category" required
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-forest-accent">
                            <option value="">Select a category...</option>
                            <option value="technical">Technical Issue</option>
                            <option value="billing">Billing & Payments</option>
                            <option value="feature">Feature Request</option>
                            <option value="bug">Bug Report</option>
                            <option value="account">Account Issues</option>
                            <option value="curator">Curator Program</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="priority" class="block text-sm font-medium text-[#4A5450] mb-2">Priority Level</label>
                        <select id="priority" required
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-forest-accent">
                            <option value="medium">Medium (24-48 hours)</option>
                            <option value="high">High (12-24 hours)</option>
                            <option value="urgent">Urgent (4-12 hours)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="message" class="block text-sm font-medium text-[#4A5450] mb-2">Message</label>
                        <textarea id="message" rows="6" required
                                  placeholder="Please describe your issue or question in detail..."
                                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-forest-accent"></textarea>
                    </div>
                    
                    <div>
                        <label for="attachments" class="block text-sm font-medium text-[#4A5450] mb-2">Attachments (Optional)</label>
                        <input type="file" id="attachments" multiple
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-forest-accent">
                        <p class="text-sm text-gray-600 mt-1">Screenshots, error logs, or other relevant files</p>
                    </div>
                    
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="urgent" class="mt-1">
                        <label for="urgent" class="text-sm text-[#4A5450]">
                            This is an urgent issue that requires immediate attention
                        </label>
                    </div>
                    
                    <button type="submit" id="submitSupport"
                            class="w-full px-6 py-3 bg-forest-accent hover:bg-[#E0751C] text-white font-semibold rounded-lg transition duration-300">
                        Submit Support Request
                    </button>
                </form>
            </div>

            <!-- Support Info -->
            <div class="bg-white rounded-xl p-8 mt-8">
                <h2 class="text-xl font-semibold mb-4 text-[#4A5450]">Support Information</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold text-[#4A5450] mb-2">Response Times</h3>
                        <ul class="space-y-2 text-sm text-gray-600">
                            <li>• <strong>Urgent:</strong> 4-12 hours</li>
                            <li>• <strong>High:</strong> 12-24 hours</li>
                            <li>• <strong>Medium:</strong> 24-48 hours</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-[#4A5450] mb-2">What to Include</h3>
                        <ul class="space-y-2 text-sm text-gray-600">
                            <li>• Clear description of the issue</li>
                            <li>• Steps to reproduce (if applicable)</li>
                            <li>• Screenshots or error messages</li>
                            <li>• Browser/device information</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                    <p class="text-sm text-blue-800">
                        <strong>Note:</strong> For general questions, you can also check our 
                        <a href="help.html" class="underline hover:text-blue-900">Help Center</a> 
                        or contact us at 
                        <a href="mailto:support@noctuaforest.com" class="underline hover:text-blue-900">support@noctuaforest.com</a>
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
        import { doc, getDoc, addDoc, collection, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';
        import { app, db } from './firebase-config.js';

        const auth = getAuth(app);
        let currentUser = null;

        // Check authentication and membership
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'account.html';
                return;
            }

            currentUser = user;
            
            // Check if user has Curator Plus
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                const userData = userDoc.exists() ? userDoc.data() : {};
                
                if (!userData.membership || userData.membership !== 'active') {
                    alert('Curator Plus membership required to access this feature.');
                    window.location.href = 'membership.html';
                    return;
                }
            } catch (error) {
                console.error('Error checking membership:', error);
                alert('Error verifying membership. Please try again.');
                return;
            }

            // Set up form submission
            setupFormSubmission();
        });

        function setupFormSubmission() {
            const form = document.getElementById('supportForm');
            const submitBtn = document.getElementById('submitSupport');
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Disable submit button
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                
                try {
                    const formData = new FormData(form);
                    const supportData = {
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        subject: formData.get('subject'),
                        category: formData.get('category'),
                        priority: formData.get('priority'),
                        message: formData.get('message'),
                        urgent: formData.get('urgent') === 'on',
                        attachments: [], // TODO: Handle file uploads
                        status: 'open',
                        createdAt: serverTimestamp(),
                        membership: 'curator_plus'
                    };
                    
                    // Add to support tickets collection
                    await addDoc(collection(db, 'supportTickets'), supportData);
                    
                    // Show success message
                    alert('Support request submitted successfully! We\'ll get back to you within the specified timeframe.');
                    
                    // Reset form
                    form.reset();
                    
                } catch (error) {
                    console.error('Error submitting support request:', error);
                    alert('Error submitting support request. Please try again.');
                } finally {
                    // Re-enable submit button
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit Support Request';
                }
            });
        }
    </script>
</body>
</html>
